#!/bin/bash -e
#
# S2I assemble script for Node.js applications
# This script is responsible for building the application artifacts

echo "---> Installing application dependencies"
if [ -f package-lock.json ]; then
  echo "Found package-lock.json, using npm ci"
  npm ci --omit=dev
else
  echo "No package-lock.json found, using npm install"
  npm install --omit=dev
fi

echo "---> Building application from source"
npm run build

echo "---> Fixing permissions"
fix-permissions ./